/**
 * 
 */
var app=angular.module("app",['ngRoute','ngCookies'])
app.config(function($routeProvider){
	$routeProvider
	.when('/registration',{
		controller:'UserCtrl',
		templateUrl:'views/registrationform.html'
	
	})
	.when('/home',{
		templateUrl:'views/home.html'
	})
	.when('/login',{
		controller:'UserCtrl',
		templateUrl:'views/login.html'
	})
	.when('/updateprofile',{
		controller:'UserCtrl',
		templateUrl:'views/updateprofile.html'//user object in updateprofile.html
	})
	.otherwise({
		templateUrl:'views/home.html'
	
	})
	
	/*app.run(function($rootScope,$cookieStore,UserService,$location){
		if($rootScope.loggedInUser==undefined)
			$rootScope.loggedInUser=$cookieStore.get('loggedInUser')
	console.log('entering logout')
			$rootScope.logout=function(){
			alert('entering logout')
			UserService.logout().then(function(response){
			$rootScope.message="Loggedout successfully..."
				delete $rootScope.loggedInUser
				$cookieStore.remove('loggedInUser')
				$location.path('/login')
			},function(response){
				$rootScope.error=response.data// ErrorClazz object returned from middleware
				$location.path('/login')
			
			})
			}
	
	})*/
	app.run(function($location,$rootScope,$cookieStore,UserService){
	if($rootScope.loggedInUser==undefined)
		$rootScope.loggedInUser=$cookieStore.get('loggedInUser')
		
	$rootScope.logout=function(){
			
		UserService.logout().then(
				function(response){
					delete $rootScope.loggedInUser;
					$cookieStore.remove('loggedInUser')
					$rootScope.message="Successfully loggedout..."
					$location.path('/login')
				},function(response){
					$rootScope.error=response.data
					if(response.status==401)
						$location.path('/login')
				})
	}
})
})